{"version":3,"sources":["slab/chrome.cljs"],"mappings":"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","names":["slab.chrome/by-id","id","js/document","slab.chrome/qs","sel","var_args","G__6099","slab.chrome/mk-el","js/Error","tag","class-name","e","slab.chrome/set-text!","el","s","slab.chrome/clear-children!","slab.chrome/append!","parent","child","slab.chrome/insert-after!","new-node","ref-node","temp__5804__auto__","p","temp__5802__auto__","n","slab.chrome/ensure-content-root!","or__5002__auto__","content","slab.chrome.mk_el","body","post","kids","cljs.core.array_seq","seq__6116","cljs.core/seq","chunk__6117","count__6118","i__6119","cljs.core/chunked-seq?","c__5525__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","k","and__5000__auto__","cljs.core.not_EQ_","slab.chrome/ensure-titlebar!","existing","page","slab.config/current-page-name","title","cljs.core/deref","slab.config/chrome*","slab.config/page-label","h","first-el","slab.chrome/ensure-tabsbar!","seq__6132","chunk__6133","count__6134","i__6135","map__6150","cljs.core/--destructure-map","cljs.core.get","map__6151","href","label","a","seq__6152","chunk__6153","count__6154","i__6155","map__6162","map__6163","slab.chrome/ensure-postamble!","slab.chrome/ensure-modeline!","m","slab.chrome/ensure-chrome!","slab.chrome/highlight-active-tab!","bar","current","links","seq__6168","chunk__6169","count__6170","i__6171","match","cljs.core.filter","cljs.core._EQ_","slab.config/basename"],"sourcesContent":["(ns slab.chrome\n  (:require [slab.config :as cfg]\n            [clojure.string :as str]))\n\n;; ------------------------------------------------------------\n;; DOM helpers\n;; ------------------------------------------------------------\n\n(defn- by-id [id] (.getElementById js/document id))\n(defn- qs [sel] (.querySelector js/document sel))\n\n(defn- mk-el\n  ([tag] (.createElement js/document tag))\n  ([tag class-name]\n   (let [e (.createElement js/document tag)]\n     (set! (.-className e) class-name)\n     e)))\n\n(defn- set-text! [el s]\n  (set! (.-textContent el) (str s))\n  el)\n\n(defn- clear-children! [el]\n  (set! (.-innerHTML el) \"\")\n  el)\n\n(defn- append! [parent child]\n  (.appendChild parent child)\n  parent)\n\n(defn- insert-after! [new-node ref-node]\n  (when-let [p (.-parentNode ref-node)]\n    (if-let [n (.-nextSibling ref-node)]\n      (.insertBefore p new-node n)\n      (.appendChild p new-node)))\n  new-node)\n\n;; ------------------------------------------------------------\n;; Static serving contract: ensure #content exists\n;; ------------------------------------------------------------\n\n(defn ensure-content-root! []\n  ;; Org export gives #content; if missing, we create it and wrap everything except #postamble.\n  (or (by-id \"content\")\n      (let [content (mk-el \"div\" \"content\")\n            body (.-body js/document)\n            post (by-id \"postamble\")\n            kids (array-seq (.-childNodes body))]\n        (set! (.-id content) \"content\")\n        ;; Move children into #content, skipping postamble if present.\n        (doseq [k kids]\n          (when (and k (not= (.-id k) \"postamble\"))\n            (.appendChild content k)))\n        ;; Insert content before postamble if it exists, else append.\n        (if post\n          (.insertBefore body content post)\n          (.appendChild body content))\n        content)))\n\n;; ------------------------------------------------------------\n;; Chrome injection (title + tabs + postamble/modeline)\n;; ------------------------------------------------------------\n\n(defn- ensure-titlebar! []\n  (let [content (ensure-content-root!)\n        existing (qs \"#content > h1.title\")\n        page (cfg/current-page-name)\n        title (str (:node @cfg/chrome*) \" \u00b7 \" (cfg/page-label page))]\n    (if existing\n      (do (set-text! existing title) existing)\n      (let [h (mk-el \"h1\" \"title\")]\n        (set-text! h title)\n        ;; Insert at top (element-aware)\n        (if-let [first-el (.-firstElementChild content)]\n          (.insertBefore content h first-el)\n          (.appendChild content h))\n        h))))\n\n(defn- ensure-tabsbar! []\n  (let [content (ensure-content-root!)\n        existing (qs \"#content > p.slab-tabs\")\n        title (or (qs \"#content > h1.title\") (ensure-titlebar!))]\n    (if existing\n      ;; Update in-place to match current tabs config\n      (do\n        (clear-children! existing)\n        (doseq [{:keys [href label]} (:tabs @cfg/chrome*)]\n          (let [a (mk-el \"a\")]\n            (.setAttribute a \"href\" href)\n            (set-text! a label)\n            (append! existing a)))\n        existing)\n      ;; Create new and insert after title\n      (let [p (mk-el \"p\" \"slab-tabs\")]\n        (doseq [{:keys [href label]} (:tabs @cfg/chrome*)]\n          (let [a (mk-el \"a\")]\n            (.setAttribute a \"href\" href)\n            (set-text! a label)\n            (append! p a)))\n        (insert-after! p title)\n        p))))\n\n(defn- ensure-postamble! []\n  (or (by-id \"postamble\")\n      (let [p (mk-el \"div\" \"status\")]\n        (set! (.-id p) \"postamble\")\n        (.appendChild (.-body js/document) p)\n        p)))\n\n(defn ensure-modeline! []\n  (let [post (ensure-postamble!)\n        existing (by-id \"modeline\")]\n    (or existing\n        (let [m (mk-el \"div\")]\n          (set! (.-id m) \"modeline\")\n          (.appendChild post m)\n          m))))\n\n(defn ensure-chrome! []\n  ;; idempotent\n  (ensure-titlebar!)\n  (ensure-tabsbar!)\n  (ensure-modeline!)\n  nil)\n\n;; ------------------------------------------------------------\n;; Active tab highlight\n;; ------------------------------------------------------------\n\n(defn highlight-active-tab! []\n  (when-let [bar (qs \"#content > p.slab-tabs\")]\n    (let [current (cfg/current-page-name)\n          links (array-seq (.querySelectorAll bar \"a\"))]\n      (doseq [a links] (.. a -classList (remove \"active\")))\n      (when-let [match (first (filter (fn [a]\n                                        (= (cfg/basename (.getAttribute a \"href\"))\n                                           current))\n                                      links))]\n        (.. match -classList (add \"active\"))))))\n"]}