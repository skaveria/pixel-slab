{"version":3,"sources":["slab/theme.cljs"],"mappings":";AAIA,+BAAA,/BAAOA,sEAAcC,EAAEC;AAAvB,AACE,OAAA,AAAA,AAAIC,2CAAiDF,EAAE,4CAAKC;;AAE9D,yBAAA,zBAAOE,0DAAUC;AAAjB,AACE,GACE,cAAAC,bAAUD;AAAGA;;AADf,GAEE,OAASA;AAAI,OAACE,gDAAQ,AAACC,0BAAeH;;AAFxC,AAAA;;;;;AAKF,+BAAA,/BAAMI;AAAN,AACE,IAAMC,QAAM,AAAYC;AAAxB,AACE,GACE,mDAAA,nDAACC,6CAAEF;AACH,uBAAA,hBAACG;;AAFH,OAKM,MAAA,NAACC,mBAAsB,qBAAA,2CAAA,wDAAA,xHAACC,nBACxB,qKAAO,WAAKC,hLACZ,PAwBA;AAzBO,AAAU,oBAAI,AAAMA;AAAK,OAAOA;;AAAtB;;SACV,WAAKC;AAAL,AACE,oBAAM,iBAAAC,oBAAKD;AAAL,AAAA,oBAAAC;AAAS,OAACC,cAAI,AAACC,oBAASH;;AAAxBC;;;AAAN,AACE,IAAMG,IAAI,AAACC,sDAAmBL;IACxBM,IAAI,AAAA,sFAASF;IACbG,MAAI,iBAAAC,mBAAI,AAACrB,uBAAS,AAAA,iFAAMmB;AAApB,AAAA,oBAAAE;AAAAA;;AAAA;;;IACJC,YAAU,iBAAAC,UAAMH;IAANG,cAAA,EAAA,CAAAA,mBAAArB,oBAAA,AAAAqB,YAAA;AAAA,AAAA,QAAAA;KAAA;AAAA;;;KAAA;AAAA;;;KAAA;AAAA;;;KAAA;AAAA;;;;AAAA;;;;AAHhB,AAWE,AAAA,sCAAA,tCAAIxB,qDAC6B,AAACyB,eAAKJ;;AAGvC,6BAAA,7BAACxB,2CAA2B0B;;AAE5B,IAAAG,0BAAc,AAAA,iGAAcN;AAA5B,AAAA,oBAAAM;AAAA,AAAA,aAAAA,TAAWC;AAAX,AAAmC,6BAAA,7BAAC9B,4CAA4B8B;;AAAhE;;AACA,IAAAD,0BAAc,AAAA,kFAAON;AAArB,AAAA,oBAAAM;AAAA,AAAA,aAAAA,TAAWE;AAAX,AAAmC,6BAAA,7BAAC/B,4CAA4B+B;;AAAhE;;AACA,IAAAF,0BAAc,AAAA,qFAAQN;AAAtB,AAAA,oBAAAM;AAAA,AAAA,cAAAA,VAAWG;AAAX,AAAmC,6BAAA,7BAAChC,4CAA4BgC;;AAAhE;;AACA,IAAAH,0BAAc,AAAA,iGAAcN;AAA5B,AAAA,oBAAAM;AAAA,AAAA,cAAAA,VAAWI;AAAX,AAAmC,6BAAA,7BAACjC,+CAA+BiC;;AAAnE;;AACA,IAAAJ,qBAAe,AAAA,mGAAeN;AAA9B,AAAA,oBAAAM;AAAA,AAAA,UAAAA,NAAWK;AAAX,AAAmC,oCAAA,7BAAClC,+CAA+BkC;;AAAnE;;;AAtBJ;;UAuBD,WAAKC;AAAL,AAAA","names":["slab.theme/set-css-var!","k","v","js/document","slab.theme/->hue-kw","x","cljs.core/Keyword","cljs.core.keyword","clojure.string/lower-case","slab.theme/fetch-theme!","proto","js/location","cljs.core._EQ_","js/Promise.resolve","js/fetch","cljs.core/clj->js","res","txt","and__5000__auto__","cljs.core/seq","clojure.string/trim","m","cljs.reader.read_string","h","hue","or__5002__auto__","hdr-color","G__6096","cljs.core/name","temp__5804__auto__","w","g","g2","cg","cg2","_"],"sourcesContent":["(ns slab.theme\n  (:require [clojure.string :as str]\n            [cljs.reader :as reader]))\n\n(defn- set-css-var! [k v]\n  (.. js/document -documentElement -style (setProperty k (str v))))\n\n(defn- ->hue-kw [x]\n  (cond\n    (keyword? x) x\n    (string? x)  (keyword (str/lower-case x))\n    :else        nil))\n\n(defn fetch-theme! []\n  (let [proto (.-protocol js/location)]\n    (cond\n      (= proto \"file:\")\n      (js/Promise.resolve nil)\n\n      :else\n      (-> (js/fetch \"/theme.edn\" (clj->js {:cache \"no-store\"}))\n          (.then (fn [res] (if (.-ok res) (.text res) nil)))\n          (.then (fn [txt]\n                   (when (and txt (seq (str/trim txt)))\n                     (let [m   (reader/read-string txt)\n                           h   (:header m)\n                           hue (or (->hue-kw (:hue h)) :green)\n                           hdr-color (case hue\n                                       :amber \"#fd971f\"\n                                       :ice   \"#a8d8ff\"\n                                       :white \"#e8e3d6\"\n                                       :green \"#a6e22e\"\n                                       \"#a6e22e\")]\n\n                       ;; Let CSS key off this immediately on future loads.\n                       (.. js/document -documentElement\n                           (setAttribute \"data-hdr-hue\" (name hue)))\n\n                       ;; Also set CSS var directly for this load.\n                       (set-css-var! \"--hdr-color\" hdr-color)\n\n                       (when-let [w  (:text-weight h)]    (set-css-var! \"--hdr-weight\" w))\n                       (when-let [g  (:glow h)]           (set-css-var! \"--hdr-glow-a\" g))\n                       (when-let [g2 (:glow2 h)]          (set-css-var! \"--hdr-glow-b\" g2))\n                       (when-let [cg (:cursor-glow h)]    (set-css-var! \"--cursor-glow-a\" cg))\n                       (when-let [cg2 (:cursor-glow2 h)]  (set-css-var! \"--cursor-glow-b\" cg2))))))\n          (.catch (fn [_] nil))))))\n"]}