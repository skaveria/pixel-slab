{"version":3,"sources":["slab/net.cljs"],"mappings":";AAIA;;;;;2BAAA,mCAAAA,9DAAMI;AAAN,AAAA,IAAAH,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;WAAAA,PAI8CQ;YAJ9C,AAAAN,4CAAAF,eAAA,nEAIWI;eAJX,AAAAF,4CAAAF,eAAA,tEAIiBK;cAJjB,AAAAH,4CAAAF,eAAA,rEAI0BM;aAJ1B,AAAAJ,4CAAAF,eAAA,pEAIkCO;AAJlC,AAKE,IAAME,UAAQ,wGAAA,2CAAA,8DAAA,sEAAA,mEAAA,1VAACC,2MAAeN,mEACGC,oEACDC,gEACD,iBAAAK,mBAAIJ;AAAJ,AAAA,oBAAAI;AAAAA;;AAAA;;;AAH/B,OAIM,MAAA,NAACC,uBACS,qBAAA,2CAAA,uDAAA,OAAA,2DAAA,2CAAA,eAAA,0BAAA,7QAACC,mUAEeJ,1VAC1B,iXAAO,WAAKK,nYAMZ;AANO,AACE,oBAAI,AAAMA;AACR,OAAOA;;OACH,AAAOA,PACP,wBAAO,WAAKC;AAAL,AACE,MAAO,KAAAC,MAAW,CAAA,iEAAA,bAAa,AAAUF,8DAAWC;;;SACrE,WAAKE;AAAL,AAEE,OAACC,sDAAmBD","names":["p__22035","map__22036","cljs.core/--destructure-map","cljs.core.get","slab.net/run-token!","token","token-id","section","params","info","payload","cljs.core.pr_str","or__5002__auto__","js/fetch","cljs.core/clj->js","resp","t","js/Error","txt","cljs.reader.read_string"],"sourcesContent":[";; src-cljs/slab/net.cljs\n(ns slab.net\n  (:require [cljs.reader :as reader]))\n\n(defn run-token!\n  \"POST token execution request to /api/run-token.\n  Request: EDN, Response: EDN.\n  Returns a JS Promise resolving to a CLJS map.\"\n  [{:keys [token token-id section params] :as info}]\n  (let [payload (pr-str {:token token\n                         :token-id token-id\n                         :section section\n                         :params (or params {})})]\n    (-> (js/fetch \"/api/run-token\"\n                  (clj->js {:method \"POST\"\n                            :headers {\"Content-Type\" \"application/edn\"}\n                            :body payload}))\n        (.then (fn [resp]\n                 (if (.-ok resp)\n                   (.text resp)\n                   (-> (.text resp)\n                       (.then (fn [t]\n                                (throw (js/Error. (str \"HTTP \" (.-status resp) \": \" t)))))))))\n        (.then (fn [txt]\n                 ;; Server must return EDN map: {:type ... :body ... :meta {...}}\n                 (reader/read-string txt))))))\n"]}