{"version":3,"sources":["slab/main.cljs"],"mappings":"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","names":["slab.main/classify-value","v","slab.panes/classify-value","slab.main/state-val","st","k","fallback","cljs.core._EQ_","slab.main/mk-el","tag","class-name","e","js/document","slab.main/mk-span","cls","txt","el","slab.main/clear-children!","slab.main/append!","parent","child","slab.main/mk-seg","seg","k-el","v-el","klass","cljs.core/seq","slab.main/render-modeline!","temp__5804__auto__","m","slab.chrome/ensure-modeline!","nrepl","http","time","battery","volume","sep","seq__6126","chunk__6127","count__6128","i__6129","cljs.core/chunked-seq?","c__5525__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","x","slab.main/tick!","slab.chrome/ensure-chrome!","slab.chrome/highlight-active-tab!","slab.theme/fetch-theme!","slab.panes/mount-all-panes!","slab.state/fetch-state!","s","slab.panes/render-panes!","js/slab","js/slab.main","js/slab.main.started?","slab.main/started?","cljs.core.atom","slab.main/start!","cljs.core/deref","cljs.core/reset!","slab.events/attach!","slab.tokens/hydrate-interactive-tokens!","slab.config/fetch-tabs!","_","js/setInterval","slab.config/poll-ms","js/console.log","slab.main/init!"],"sourcesContent":[";; src-cljs/slab/main.cljs\n(ns slab.main\n  (:require [slab.events :as events]   ;; interactive tokens (run-token)\n            [slab.config :as cfg]\n            [slab.chrome :as chrome]\n            [slab.panes :as panes]\n            [slab.tokens :as tokens]\n            [slab.theme :as theme]\n            [slab.state :as state]))\n\n;; ------------------------------------------------------------\n;; Modeline rendering (kept here for now)\n;; ------------------------------------------------------------\n\n(defn- classify-value [v]\n  (panes/classify-value v))\n\n(defn- state-val [st k fallback]\n  (let [v (when st (aget st k))]\n    (if (or (nil? v) (undefined? v) (= \"\" (str v)))\n      fallback\n      (str v))))\n\n(defn- mk-el [tag class-name]\n  (let [e (.createElement js/document tag)]\n    (set! (.-className e) class-name)\n    e))\n\n(defn- mk-span [cls txt]\n  (let [el (.createElement js/document \"span\")]\n    (set! (.-className el) cls)\n    (set! (.-textContent el) (str txt))\n    el))\n\n(defn- clear-children! [el]\n  (set! (.-innerHTML el) \"\")\n  el)\n\n(defn- append! [parent child]\n  (.appendChild parent child)\n  parent)\n\n(defn- mk-seg [k v]\n  (let [seg (mk-el \"span\" \"seg\")\n        k-el (mk-span \"k\" k)\n        v-el (mk-span \"v\" v)\n        klass (classify-value v)]\n    (when (seq klass)\n      (.. v-el -classList (add klass)))\n    (append! seg k-el)\n    (append! seg v-el)\n    seg))\n\n(defn render-modeline! [st]\n  (when-let [m (chrome/ensure-modeline!)]\n    (clear-children! m)\n    (let [nrepl   (state-val st \"nrepl\" \"\u2014\")\n          http    (state-val st \"http\" \"\u2014\")\n          time    (state-val st \"time\" \"\u2014\")\n          battery (state-val st \"battery\" \"\u2014\")\n          volume  (state-val st \"volume\" \"\u2014\")\n          sep     (fn [] (mk-span \"sep\" \"\u00b7\"))]\n      (append! m (mk-span \"node\" \"slab\"))\n      (doseq [x [(sep) (mk-seg \":nrepl\" nrepl)\n                 (sep) (mk-seg \":http\" http)\n                 (sep) (mk-seg \":time\" time)\n                 (sep) (mk-seg \":battery\" battery)\n                 (sep) (mk-seg \":volume\" volume)]]\n        (append! m x))))\n  nil)\n\n;; ------------------------------------------------------------\n;; Tick/init\n;; ------------------------------------------------------------\n\n(defn tick! []\n  (chrome/ensure-chrome!)\n  (chrome/highlight-active-tab!)\n  (theme/fetch-theme!)\n  (panes/mount-all-panes!)\n  (-> (state/fetch-state!)\n      (.then (fn [s]\n               (when s (panes/render-panes! s))\n               (render-modeline! s)))))\n\n(defonce ^:private started? (atom false))\n\n(defn start! []\n  (when-not @started?\n    (reset! started? true)\n\n    ;; interactive token clicks\n    (events/attach!)\n\n    ;; build clickable {{name*}} tokens + slots\n    (tokens/hydrate-interactive-tokens!)\n\n    ;; tabs.edn once\n    (-> (cfg/fetch-tabs!)\n        (.then (fn [_]\n                 (chrome/ensure-chrome!)\n                 (chrome/highlight-active-tab!))))\n\n    (tick!)\n    (js/setInterval tick! cfg/poll-ms)\n\n    (js/console.log \"slab client online (full)\")))\n\n(defn init! []\n  ;; Delay until <body> exists.\n  (if (.-body js/document)\n    (start!)\n    (.addEventListener js/document \"DOMContentLoaded\" start!)))\n\n(init!)\n"]}